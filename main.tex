\documentclass[10pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm  }
\usepackage{fancyhdr}
\usepackage[margin=0.5in]{geometry}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{pdfpages}
\usepackage{standalone}
\usepackage{titling}
\usepackage{braket}
\usepackage{color}
\usepackage{hyperref}
\usepackage{wrapfig}
\usepackage{float}


\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\lstset{
  language=C,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

\newcommand{\NN}{\mathbb{N}} % Naturals
\newcommand{\ZZ}{\mathbb{Z}} % Integers
\newcommand{\QQ}{\mathbb{Q}} % Rationals
\newcommand{\RR}{\mathbb{R}} % Reals
\newcommand{\CC}{\mathbb{C}} % Imaginaries
\newcommand{\HH}{\mathbb{H}} % Quaternions
\newcommand{\FF}{\mathbb{F}} % Field

\newcommand{\ud}{\,\mathrm{d}} % Single-var differential (use like \partial)

\newcommand{\CoulombConstant}{\frac{1}{4\pi\epsilon_0}}

\DeclareMathOperator{\erf}{erf} % Error Function
\DeclareMathOperator{\erfc}{erfc} % Complementary Error Function
\DeclareMathOperator{\erfi}{erfi} % Imaginary Error Function
\DeclareMathOperator{\row}{row} % Matrix Row
\DeclareMathOperator{\col}{col} % Matrix Column
\DeclareMathOperator{\trace}{tr} % Matrix Trace
\DeclareMathOperator{\proj}{proj} % Vector Projection

\title{PHYS 319 Final Project: PWM-Based Synthesizer}
\author{Ashtan Mistal}
\date{April 2022}

\begin{document}

\maketitle

\break

\tableofcontents{}

\break

% TODO:
% - finish abstract
% - edit introduction
% - Measure input on a FFT on Studio One (a spectral filter may be more accurate)
% - Compare to proper square wave
% - accuracy of the square wave frequency using a tuner
% - add conclusion
% - finish theory for tjhe ADSR envelope
% - add appendix for the ADSR envelope code
% - add appendix for the square wave code (PWM code)
% - finish Table of Notes to Frequency Values appendix
% - make circuit diagrams for current project and previous rendition
% - add bibliography


\section{Abstract}\label{sec:abstract}

% [abstract here]

\section{Introduction}\label{sec:introduction}

% [introduction here]
Exploration into the possibility of creating a user-controlled, MIDI\footnote{musical instrument digital interface}-compatible fully featured synthesizer has held a personal interest shortly after I became interested in music production itself.
Motivation for this project to encompass this personal interest stemmed from first using pulse width modulation to change the brightness of a bulb during an earlier lab.
Since my more recent interest in audio equipment itself, I was motivated to do an audio-related project.
The purpose of this project, as a result, was to help me gain a further understanding into the inner workings of oscillators and envelope generators, gain an appreciation for the MIDI standard, and of course to have a working, hand-made synthesizer for future music production related use.
All three areas of knowledge mentioned above would aid in future audio-related projects, both in software as well as in hardware, and help inspire for future related projects.
This project builds off of my previous related experience in music production, which provided me with a background on audio synthesis and processing.

\section{Theory}\label{sec:theory}
\input{theory}

\section{Apparatus}\label{sec:apparatus}
\input{apparatus}

\section{Results}\label{sec:results}

% How did the device perform? Did it work according to the expectations? Comparison of theory to results obtained (as quantitative as possible). Problems encountered, graph(s) of data obtained, if appropriate, accuracy of the device (if it is a measuring instrument).
Unfortunately, the 3 oscillator version did not work properly due to software limitations.
When iterating through the different waveforms, the period set in the for loop was wildly inaccurate.
This was due to the fact that this was largely hardware-based, and did not use a timer to ensure accuracy of the period being set.
Hence, the actual period was based on the number of CPU cycles that were executed, which changed based on the period due to numerous factors.

Some of these factors include the use of multiplication, division, and modulo, which were not available in the MSP430G2553 microprocessor on a hardware level and thus were computationally expensive.
Because there was this large computational overhead, not only was the waveform itself inaccurate, but the MIDI data was unable to be processed in a timely manner.
The 3 oscillator version was therefore only able to act as a noise generator, and was not able to be used as a semi-realistic synthesizer.

Nonetheless, the PWM based, single oscillator version was much more accurate than the 3 oscillator version.
The PWM based version was able to accurately reproduce a square wave with a given period, mainly due to the fact that the PWM is based on a timer, which is able to accurately set the period and is also not based on the number of CPU cycles.





\section{Discussion}\label{sec:discussion}

% Discuss what went well, and what could have been better, possible improvements to the device.

It would have been a much better idea to use 3 PWM signals instead of 3 iterative waveforms, and modify the period and duty cycle accordingly to match the given waveform being played.
This would have allowed for a much more accurate representation of the waveform being played, and would have allowed for the use of a timer to accurately set the duty cycle.
Of course, this may have had its own limitations as well, as we would have to be accurately changing the duty cycle of the PWM signal, and this would have required another timer to be used, along with numerous interrupts.
This may have been a better idea, but still is at risk of being too computationally expensive due to the constant changing of the duty cycle with a semi-unknown period (due to the fact that we have so many notes that could be played)
Early analog synthesizers combated this problem, and simultaneously allowed for polyphony, by using a separate waveform generator for each note.
But alas, this is too expensive for our microprocessor, and the 3 oscillator version was not able to be used as a real-time synthesizer, and the PWM based version was not "interesting" enough for real-world use (albeit was much more accurate and actually playable).

The primary source of inaccuracy for the PWM based version was the DAC being used to convert the notes being pressed to an analog signal.
Precision resistors were not used, and so a lot of fluctuation was observed in the analog input signal.
This is observed in the FFT signal discussed inFigure~\ref{fig:fft}.

\section{Conclusions}\label{sec:conclusions}

% Was it worth constructing? What did you learn?



%include references here
% Sources other than the course lab manual or lab web page should be referenced. Especially if your code is based on code you found on the web or elsewhere, you should make sure that the body of your report contains a clear citation to the source you used, and a corresponding reference here in the references section. In the body of the report, you should also explain clearly what differentiates your code from the source you used.

\appendix

\section{Appendix A: Table of Notes to Frequency Values}\label{sec:-table-of-notes-to-frequency-values}



% Any additional material that should be included in the report, but not necessary for the main body can be included as appendices. You should definitely include (well-annotated) program listings.

\begin{table}[h]
    \centering
    \begin{tabular}{c|c}
         &  \\
         & 
    \end{tabular}
    \caption{Table of Notes to Frequency Values}
    \label{tab:pianonotestofrequency}
\end{table}

\section{Appendix B: C Code for Decoding MIDI Data}\label{sec:appendix-b:-c-code-for-decoding-midi-data}
\input{appendix-b-c-code-for-decoding-midi-data}

\end{document}
